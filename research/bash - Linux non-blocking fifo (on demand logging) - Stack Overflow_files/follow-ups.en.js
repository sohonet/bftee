(()=>{"use strict";var e={p:""};e.p=document.getElementById("webpack-public-path").innerText+"Js/",(()=>{function e(e,t,o=void 0,n=void 0){const s=new FormData;s.append("fKey",null!=n?n:StackExchange.options.user.fkey),s.append("data",JSON.stringify(t)),s.append("event",e);let a={};o&&(a["X-Previous-Event-Id"]=o),fetch((StackExchange.options.site.routePrefix||"")+"/stackevent",{method:"POST",keepalive:!0,body:s,headers:a}).then((()=>{}))}var t;const o=600,n=(null===(t=document.getElementById("js-follow-ups-experiment-group"))||void 0===t?void 0:t.getAttribute("data-experiment-group"))||"test",s=(e,t)=>{e.querySelectorAll(t.join(", ")).forEach((e=>{e.classList.toggle("d-none")}))},a=e=>{var t;if(e&&!e.classList.contains("d-none"))null===(t=e.querySelector("textarea"))||void 0===t||t.focus();else{const t=e.querySelector("textarea");t&&(t.value="")}};async function r(t,o,s,a,r){var c;t.preventDefault();const i=o.getAttribute("data-post-id");null==s||s.classList.add("is-loading");let d,u=!1;const m=parseInt((null===(c=document.querySelector(".js-question"))||void 0===c?void 0:c.getAttribute("data-questionid"))||"0"),p=parseInt(i||"0"),f=parseInt(o.getAttribute("data-total-comment-count")||"0"),h=[...document.querySelectorAll(".js-follow-ups-container")].indexOf(o);try{const e=new FormData;e.append("comment",a.value),e.append("fkey",StackExchange.options.user.fkey);const t=await fetch(`/posts/${i}/comments`,{method:"POST",body:e});if(!t.ok){const e=await t.text()||__tr(["An error occurred while attempting to submit your comment"], undefined, "en", []);throw new Error(e)}{u=!0;const e=await t.text(),n=new DOMParser,s=n.parseFromString(e,"text/html").querySelectorAll(".js-comment");d=parseInt(s[s.length-1].getAttribute("data-comment-id")||"0"),await l(o,{topCommentsOnly:!1,scrollToContainerEnd:r})}}catch(e){null==s||s.classList.remove("is-loading");let t=__tr(["An error occurred during edit submit."], undefined, "en", []);e instanceof Error&&e.message&&(t=e.message),StackExchange.helpers.showToast(t,{type:"danger"})}e("follow_ups_ui_experiment.comment.submit",{source:window.location.href,submitSuccess:u,questionId:m,answerId:p,commentId:d,numberOfPreExistingComments:f,answerPositionOnPage:h,followUpsUIExperimentGroup:n})}async function l(e,t={}){var o;if(e){const n=null!==(o=null==t?void 0:t.topCommentsOnly)&&void 0!==o?o:"True"===e.getAttribute("data-top-comments-only"),s=e.getAttribute("data-post-id"),a=await fetch(`/posts/${s}/follow-ups`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topCommentsOnly:n,includeDeleted:!!t.includeDeleted})}),r=await a.text(),l=e.parentElement;if(l){l.innerHTML=r;const e=l.firstElementChild;e&&y([e]);const o=l.querySelectorAll(".js-follow-up");if(t.scrollToContainerEnd&&o.length>5){const e=o[o.length-2];setTimeout((()=>{e.scrollIntoView({behavior:"smooth",block:"start"})}),0)}}}}const c=(e,t,n,s)=>{const a=e.querySelector(t),r=e.querySelector(n),l=e.querySelector(s);a&&r&&l&&(null==a||a.addEventListener("input",(e=>((e,t,n)=>{const s=e.target.value.trim().split(/\s+/).filter((e=>!e.startsWith("@"))).join(" ").length;let a="";t.classList.remove("fc-red-400","supernova"),s<15?(a=0===s?"Enter at least 15 characters":15-s+" more to go...",n.disabled=!0):s>o?(a=`Too long by ${s-o} characters`,t.classList.add("fc-red-400"),n.disabled=!0):(n.disabled=!1,o-s<=50&&(a=o-s+" characters left",t.classList.add("supernova"))),""!==a?(t.textContent=a,t.style.display="inline"):t.style.display="none"})(e,r,l))))},i=e=>{e.querySelectorAll(".js-follow-up-delete").forEach((t=>t.addEventListener("click",(o=>(async(e,t,o)=>{e.preventDefault();const n=o.closest(".js-follow-up"),s=null==n?void 0:n.getAttribute("data-follow-up-id"),a=new FormData;a.append("fkey",StackExchange.options.user.fkey),o.classList.add("is-loading");try{const e=await fetch(`/posts/comments/${s}/vote/10`,{method:"POST",body:a});if(!e.ok){const t=await e.text()||__tr(["An error occurred while attempting to delete your comment"], undefined, "en", []);throw new Error(t)}await l(t,{topCommentsOnly:!1,includeDeleted:!0})}catch(e){o.classList.remove("is-loading"),StackExchange.helpers.showToast(__tr(["An error occurred while attempting to delete your comment"], undefined, "en", []),{type:"danger"})}})(o,e,t)))))},d=e=>{e.querySelectorAll(".js-follow-up-undelete").forEach((t=>t.addEventListener("click",(o=>(async(e,t,o)=>{e.preventDefault();const n=t.getAttribute("data-post-id"),s=o.closest(".js-follow-up"),a=null==s?void 0:s.getAttribute("data-follow-up-id"),r=new FormData;r.append("fkey",StackExchange.options.user.fkey),o.classList.add("is-loading");try{(new FormData).append("fkey",StackExchange.options.user.fkey);const e=await fetch(`/admin/posts/${n}/comments/${a}/undelete`,{method:"POST",body:r});if(!e.ok){const t=await e.text()||__tr(["An error occurred while attempting to undelete your comment"], undefined, "en", []);throw new Error(t)}await l(t)}catch(e){o.classList.remove("is-loading"),StackExchange.helpers.showToast(__tr(["An error occurred while attempting to undelete your comment"], undefined, "en", []),{type:"danger"})}})(o,e,t)))))},u=t=>{t.querySelectorAll(".js-vote-button").forEach((o=>{o.classList.contains("is-disabled")?o.addEventListener("click",(s=>{var a,r;s.preventDefault();const l=parseInt((null===(a=document.querySelector(".js-question"))||void 0===a?void 0:a.getAttribute("data-questionid"))||"0"),c=parseInt(t.getAttribute("data-post-id")||"0"),i=parseInt((null===(r=o.closest(".js-follow-up"))||void 0===r?void 0:r.getAttribute("data-follow-up-id"))||"0");e("follow_ups_ui_experiment.vote_attempt",{source:window.location.href,questionId:l,answerId:c,commentId:i,followUpsUIExperimentGroup:n})})):o.addEventListener("click",(e=>(async(e,t,o)=>{e.preventDefault();const n=t.getAttribute("data-post-id"),s=o.closest(".js-follow-up"),a=null==s?void 0:s.getAttribute("data-follow-up-id"),r=o.classList.contains("bc-orange-400")?0:2,c=new FormData;c.append("fkey",StackExchange.options.user.fkey),o.classList.add("is-loading");try{const e=await fetch(`/posts/comments/${a}/vote/${r}`,{method:"POST",body:c});if(!e.ok)throw new Error;const t=await e.json();if(!t.Success)throw new Error(t.Message);const o=document.querySelector(`.js-follow-ups-container[data-post-id="${n}"]`);await l(o)}catch(e){o.classList.remove("is-loading");let t=__tr(["An error occurred during voting."], undefined, "en", []);e instanceof Error&&e.message&&(t=e.message),StackExchange.helpers.showToast(t,{type:"danger",useRawHtml:!0})}})(e,t,o)))}))};const m=e=>{e.querySelectorAll("button.js-follow-up-edit, button.js-edit-comment-cancel").forEach((e=>{const t=e.closest(".js-follow-up");t&&e.addEventListener("click",(()=>{e.classList.contains("js-follow-up-edit")&&(c(t,".edit-comment-form .js-comment-text-input",".edit-comment-form .js-char-counter",".js-edit-comment-submit"),async function(e){const t=e.querySelector(".edit-comment-form .js-comment-text-input"),o=e.getAttribute("data-follow-up-id"),n=await fetch(`/get-text/follow-ups/${o}`),s=await n.text();t&&(t.value=s,t.dispatchEvent(new Event("input")))}(t)),s(t,[".js-toggle-for-edit",".edit-comment-form"]),t.querySelectorAll(".reply-to-comment-form").forEach((e=>{e.classList.contains("d-none")||e.classList.add("d-none")})),a(t.querySelector(".edit-comment-form"))}))}));e.querySelectorAll("button.js-edit-comment-submit").forEach((t=>{const o=t.closest(".js-follow-up");if(!o)return;const n=o.querySelector(".edit-comment-form .js-comment-text-input"),s=o.getAttribute("data-follow-up-id");t.addEventListener("click",(t=>async function(e,t,o,n){var s,a;e.preventDefault();const r=t.querySelector(`.js-follow-up[data-follow-up-id="${o}"]`),c=null===(a=null===(s=r.querySelector(".edit-comment-form .js-comment-body"))||void 0===s?void 0:s.textContent)||void 0===a?void 0:a.trim();if(c&&n.value.trim()===c)return void StackExchange.helpers.showToast(__tr(["No changes were made to the comment!"], undefined, "en", []),{type:"danger"});const i=r.querySelector(".js-edit-comment-submit");null==i||i.classList.add("is-loading");const d=r.getAttribute("data-reply-to-user-name"),u=new FormData;u.append("fkey",StackExchange.options.user.fkey),u.append("comment",w(n,d));try{const e=await fetch(`/posts/comments/${o}/edit`,{method:"POST",body:u});if(!e.ok){const t=await e.text()||__tr(["An error occurred during edit submit."], undefined, "en", []);throw new Error(t)}await l(t)}catch(e){null==i||i.classList.remove("is-loading");let t=__tr(["An error occurred during edit submit."], undefined, "en", []);e instanceof Error&&e.message&&(t=e.message),StackExchange.helpers.showToast(t,{type:"danger",useRawHtml:!0})}}(t,e,s,n)))}))},p=t=>{const o=t.querySelectorAll("button.js-follow-up-reply-to"),s=t.querySelectorAll("button.js-reply-to-comment-cancel");o.forEach((o=>{const s=o.closest(".js-follow-up");s&&o.addEventListener("click",(()=>{var o;c(s,".reply-to-comment-form .js-comment-text-input",".reply-to-comment-form .js-char-counter",".js-reply-to-comment-submit"),s.querySelectorAll(".reply-to-comment-form").forEach((e=>{e.classList.contains("d-none")&&e.classList.remove("d-none")}));const a=s.querySelector(".reply-to-comment-form textarea");a&&a.focus();const r=parseInt((null===(o=document.querySelector(".js-question"))||void 0===o?void 0:o.getAttribute("data-questionid"))||"0"),l=parseInt(t.getAttribute("data-post-id")||"0"),i=[...document.querySelectorAll(".js-follow-ups-container")].indexOf(t),d=parseInt(t.getAttribute("data-total-comment-count")||"0");e("follow_ups_ui_experiment.reply_button_click",{source:window.location.href,followUpsUIExperimentGroup:n,questionId:r,answerId:l,answerPositionOnPage:i,numberOfPreExistingComments:d})}))})),s.forEach((e=>{const t=e.closest(".js-follow-up");t&&e.addEventListener("click",(()=>{t.querySelectorAll(".reply-to-comment-form").forEach((e=>{e.classList.contains("d-none")||e.classList.add("d-none")})),a(t.querySelector(".reply-to-comment-form"))}))}));t.querySelectorAll("button.js-reply-to-comment-submit").forEach((o=>{const s=o.closest(".js-follow-up");if(!s)return;const a=s.querySelector(".js-comment-text-input"),r=s.getAttribute("data-follow-up-id");o.addEventListener("click",(o=>async function(t,o,s,a,r){var c;t.preventDefault();const i=o.getAttribute("data-post-id"),d=s.querySelector(".js-reply-to-comment-submit");null==d||d.classList.add("is-loading");let u,m=!1;const p=parseInt((null===(c=document.querySelector(".js-question"))||void 0===c?void 0:c.getAttribute("data-questionid"))||"0"),f=parseInt(i||"0"),h=parseInt(o.getAttribute("data-total-comment-count")||"0"),y=[...document.querySelectorAll(".js-follow-ups-container")].indexOf(o),g=a.closest(".js-follow-up"),v=null==g?void 0:g.getAttribute("data-user-name");try{const e=new FormData;e.append("comment",w(a,v)),e.append("parentCommentId",r),e.append("fkey",StackExchange.options.user.fkey);const t=await fetch(`/posts/${i}/comments`,{method:"POST",body:e});if(!t.ok){const e=await t.text()||__tr(["An error occurred while attempting to submit your comment"], undefined, "en", []);throw new Error(e)}{m=!0;const e=await t.text(),n=(new DOMParser).parseFromString(e,"text/html").querySelectorAll(".js-comment");u=parseInt(n[n.length-1].getAttribute("data-comment-id")||"0"),await l(o,{topCommentsOnly:!1})}}catch(e){null==d||d.classList.remove("is-loading");let t=__tr(["An error occurred during edit submit."], undefined, "en", []);e instanceof Error&&e.message&&(t=e.message),StackExchange.helpers.showToast(t,{type:"danger"})}e("follow_ups_ui_experiment.comment.submit",{source:window.location.href,submitSuccess:m,questionId:p,answerId:f,commentId:u,numberOfPreExistingComments:h,answerPositionOnPage:y,followUpsUIExperimentGroup:n})}(o,t,s,a,r)))}))},f=e=>document.querySelector(`div[data-follow-up-id="${e}"]`),h=(e,t=!1)=>{e.classList.add("comment__highlight"),t&&e.scrollIntoView({behavior:"smooth",block:"center"})};function w(e,t){if(!t||""===t.trim())return e.value;return`@${function(e){const t=document.createElement("textarea");return t.innerHTML=e,t.value}(t)} `+e.value}const y=t=>{(null!=t?t:document.querySelectorAll(".js-follow-ups-container")).forEach((t=>{const o=t.querySelector(".js-bottom-bar");(t=>{t.querySelectorAll("button.js-reply-bar, button.js-add-comment-cancel").forEach((o=>{o.addEventListener("click",(()=>{var r;if(s(t,[".js-reply-bar",".add-comment-form"]),a(t.querySelector(".add-comment-form")),o.classList.contains("js-reply-bar")){const o=parseInt((null===(r=document.querySelector(".js-question"))||void 0===r?void 0:r.getAttribute("data-questionid"))||"0"),s=parseInt(t.getAttribute("data-post-id")||"0"),a=[...document.querySelectorAll(".js-follow-ups-container")].indexOf(t),l=parseInt(t.getAttribute("data-total-comment-count")||"0");e("follow_ups_ui_experiment.reply_bar_click",{source:window.location.href,followUpsUIExperimentGroup:n,questionId:o,answerId:s,answerPositionOnPage:a,numberOfPreExistingComments:l})}}))}))})(t),c(t,".js-comment-text-input",".js-char-counter",".js-add-comment-submit"),(e=>{const t=e.querySelector(".js-add-comment-submit"),o=e.querySelector(".js-comment-text-input");t&&o&&(t.addEventListener("click",(n=>r(n,e,t,o,!0))),o.addEventListener("keydown",(n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),r(n,e,t,o,!0))})))})(t),o&&(((e,t)=>{const o=e.querySelector(".js-add-comment-bottom-submit"),n=e.querySelector(".js-comment-text-input");o&&n&&(o.addEventListener("click",(e=>r(e,t,o,n,!1))),n.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),r(e,t,o,n,!1))})))})(o,t),function(t){const o=t.querySelector("button.js-add-comment-bottom-button"),s=t.querySelector("button.js-add-comment-bottom-cancel");o&&o.addEventListener("click",(()=>{var o;const s=t.querySelector(".add-comment-bottom-form");(null==s?void 0:s.classList.contains("d-none"))&&(null==s||s.classList.remove("d-none")),a(t.querySelector(".add-comment-bottom-form"));const r=parseInt((null===(o=document.querySelector(".js-question"))||void 0===o?void 0:o.getAttribute("data-questionid"))||"0"),l=parseInt(t.getAttribute("data-post-id")||"0"),c=[...document.querySelectorAll(".js-follow-ups-container")].indexOf(t),i=parseInt(t.getAttribute("data-total-comment-count")||"0");e("follow_ups_ui_experiment.add_comment_bottom_link_click",{source:window.location.href,followUpsUIExperimentGroup:n,questionId:r,answerId:l,answerPositionOnPage:c,numberOfPreExistingComments:i})})),s&&s.addEventListener("click",(()=>{const e=t.querySelector(".add-comment-bottom-form");(null==e?void 0:e.classList.contains("d-none"))||null==e||e.classList.add("d-none"),a(t.querySelector(".add-comment-bottom-form"))}))}(o),c(o,".js-comment-text-input",".js-char-counter",".js-add-comment-bottom-submit")),i(t),d(t),u(t),(e=>{const t=e.getAttribute("data-post-id"),o=e.getAttribute("data-comment-flags-remaining-today");e.querySelectorAll(".js-flag-button").forEach((e=>{const n=e.getAttribute("data-follow-up-id");e.addEventListener("click",(()=>{dispatchEvent(new CustomEvent("flagButtonClick",{detail:{postId:t,followUpId:n,commentFlagsRemainingToday:o}}))}))}))})(t),(e=>{const t=e.getAttribute("data-post-id");e.querySelectorAll(".js-flag-retract-button").forEach((e=>{const o=e.getAttribute("data-follow-up-id");e.addEventListener("click",(()=>{dispatchEvent(new CustomEvent("flagButtonClick",{detail:{postId:t,followUpId:o,retracting:!0}}))}))}))})(t),m(t),(e=>{const t=e.querySelectorAll(".js-follow-up-copy-link"),o=e.getAttribute("data-post-id");t.forEach((e=>{e.addEventListener("click",(async t=>{t.preventDefault();const n=e.closest(".js-follow-up"),s=null==n?void 0:n.getAttribute("data-follow-up-id"),a=`${window.location.origin}${window.location.pathname}#comment${s}_${o}`;try{await navigator.clipboard.writeText(a),StackExchange.helpers.showToast(__tr(["Link copied to clipboard!"], undefined, "en", []),{type:"success"})}catch{StackExchange.helpers.showToast(__tr(["Failed to copy link to clipboard."], undefined, "en", []),{type:"danger"})}}))}))})(t),(e=>{const t=e.querySelector(".js-full-collapse");t&&t.addEventListener("click",(()=>{e.querySelectorAll(".js-follow-ups, .js-arrow").forEach((e=>{e.classList.toggle("d-none")}))}))})(t),(e=>{const t=e.querySelector(".js-show-more-button");t&&t.addEventListener("click",(async()=>{await l(e,{topCommentsOnly:!1})}))})(t),p(t)})),document.querySelectorAll(".js-fetch-deleted-follow-ups").forEach((e=>{const t=e.closest(".js-answer"),o=null==t?void 0:t.querySelector(".js-follow-ups-container");o&&e.addEventListener("click",(async t=>{if(t.preventDefault(),o){const t=e.classList.toggle("showing-deleted");await l(o,{topCommentsOnly:!1,includeDeleted:t})}}),{once:!0})}))};y(),(()=>{let e="";window.addEventListener("flagSubmitted",(async t=>{const{postId:o,followUpId:n,flagReasonSelected:s,otherText:a}=t.detail,r=a===e;e=a;const c=new FormData;c.append("fkey",StackExchange.options.user.fkey),c.append("otherText",a),c.append("overrideWarning",r.toString());try{const e=await fetch(`/flags/comments/${n}/add/${s}`,{method:"POST",body:c});if(!e.ok)throw new Error;const t=await e.json();if(!t.Success)throw 1===t.Outcome&&StackExchange.helpers.showToast(t.Message,{type:"warning"}),new Error(t.Message);dispatchEvent(new CustomEvent("addFlagResponseReceived",{detail:{success:!0}}));const a=document.querySelector(`.js-follow-ups-container[data-post-id="${o}"]`);await l(a),StackExchange.helpers.showToast(__tr(["Thanks for flagging! We take your reports seriously."], undefined, "en", []),{type:"success",transientTimeout:3e3})}catch(e){let t=__tr(["An error occurred during flagging."], undefined, "en", []);e instanceof Error&&e.message&&(t=e.message),StackExchange.helpers.showToast(t,{type:"danger",useRawHtml:!0}),dispatchEvent(new CustomEvent("addFlagResponseReceived",{detail:{success:!1}}))}}))})(),window.addEventListener("flagRetract",(async e=>{const{postId:t,followUpId:o,flagReasonSelected:n}=e.detail,s=new FormData;s.append("fkey",StackExchange.options.user.fkey);try{const e=await fetch(`/flags/comments/${o}/retract/${n}`,{method:"POST",body:s});if(!e.ok)throw new Error;const a=await e.json();if(!a.Success)throw new Error(a.Message);const r=document.querySelector(`.js-follow-ups-container[data-post-id="${t}"]`);await l(r),StackExchange.helpers.showToast(__tr(["Your flag has been retracted."], undefined, "en", []),{type:"success",transientTimeout:3e3})}catch(e){let t=__tr(["An error occurred while trying to retract your flag."], undefined, "en", []);e instanceof Error&&e.message&&(t=e.message),StackExchange.helpers.showToast(t,{type:"danger",useRawHtml:!0})}})),StackExchange.ready((()=>{document.querySelectorAll(".js-follow-ups-container").length>0&&(()=>{const e=window.location.hash;if(!e.startsWith("#comment"))return;const[t,o]=e.replace("#comment","").split("_");t&&o&&!isNaN(Number(t))&&!isNaN(Number(o))&&null===document.querySelector(`.js-question[data-questionid="${o}"]`)&&setTimeout((()=>{const e=f(t);if(e)return void h(e);const n=document.querySelector(`.js-follow-ups-container[data-post-id="${o}"]`);n?l(n,{topCommentsOnly:!1,includeDeleted:!0}).then((()=>{const e=f(t);e?h(e,!0):StackExchange.helpers.showToast(__tr(["Comment not found."], undefined, "en", []),{type:"danger"})})):StackExchange.helpers.showToast(__tr(["Comment not found."], undefined, "en", []),{type:"danger"})}),300)})()}))})()})();